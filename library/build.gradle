apply plugin: 'com.android.library'
apply from: "https://gist.githubusercontent.com/sephiroth74/381981d26cd00fc28812/raw/b6e11cc8dcf8d2f99506a3a87c256305cc3b2015/local-mvn-push.gradle"

group GROUP
version VERSION_NAME

dependencies {}

android {
    compileSdkVersion 23
    buildToolsVersion '23.0.2'

    defaultConfig {
        versionCode 1
        versionName version
        minSdkVersion 14
        targetSdkVersion 23
    }
}

task updateVersion {
    def source = new File("src/it/sephiroth/android/library/imagezoom/ImageViewTouchBase.java")

    onlyIf { task ->
        def src = project.file(source)
        def text = src.text
        def pattern = /(?ms)^\s*public static final String VERSION = "($project.version)";$/
        def matcher = (text =~ pattern)

        if (matcher.size() > 0) {
            return false
        }

        return true
    }

    doLast {
        def src = project.file(source)

        println "Version mismatch. updating version to ${project.version}"

        def text = src.text
        def pattern = /(?ms)^(\s*)(public static final String VERSION = ")([0-9\-a-zA-Z\.]+)(";)$/
        def matcher = (text =~ pattern)

        if (matcher.size() > 0) {
            text = matcher.replaceFirst("\$1\$2" + project.version + "\$4")
            src.setText(text)
            println "Updated version of ImageViewTouchBase.java to ${project.version}"
        }

    }
}
